cmake_minimum_required(VERSION 3.17 FATAL_ERROR) 
project(MPI_Advance VERSION 1.0.0 LANGUAGES C)

option(SPACK "system is being built using SPACK" OFF)
option(MPIA_PC "build MPIPCL shared library." ON)
option(MPIA_ST "Build MPIA Stream Triggering Library." ON)
option(MPIA_TA "BUILD MPIA Topology Aware Libraries." ON)
option(CUDA_SUPPORT "BUILD WITH CUDA BACKENDS" OFF)
option(HIP "BUILD WITH HIP BACKENDS" OFF)
option(CXI "BUILD WITH CXI BACKENDS" OFF)
option(HPE "BUILD WITH HPE BACKENDS" OFF)
option(BUILD_TESTS "BUILD Tests and examples" OFF)

include_directories(./include)

if(NOT SPACK)
	set(CMAKE_INSTALL_PREFIX "${CMAKE_CURRENT_BINARY_DIR}/installed" CACHE PATH "install prefix" FORCE)
endif(NOT SPACK)

if(MPIA_PC)
	if(BUILD_TESTS)
		set(BUILD_EXAMPLES ON)
		set(EXAMPLES_TO_BIN ON)
	endif()
	add_subdirectory(./MPIPCL)
	
endif(MPIA_PC)

if(MPIA_ST)
	if(CUDA_SUPPORT)
		set(USE_CUDA_BACKEND ON)
	endif()	
	if(HIP)
		set(USE_HIP_BACKEND ON)
	endif()	
	if(CXI)
		set(USE_CXI_BACKEND ON)
	endif()
	if(HPE)
		set(USE_HPE_BACKEND ON)
	endif()
	add_subdirectory(./stream-triggering)
endif(MPIA_ST)

if(MPIA_TA)
	if(CUDA_SUPPORT)
	    set(USE_CUDA_BACKEND ON)
    	endif()
	if(HIP)
		set(USE_HIP ON)
	endif()
	if(BUILD_TESTS)
		set(ENABLE_UNIT_TESTS ON)
	endif()
	add_subdirectory(./locality_aware)
endif(MPIA_TA)


